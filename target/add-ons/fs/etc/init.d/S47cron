#!/bin/sh
#
# Cron services.
#
# Written by Vladik Goytin.

cron_start()
{

	if [ ${NORMALBOOT} -eq 1 ]; then 
		ntpd -qdn -p pool.ntp.org
		[ `date +"%Y"` -le 2010 ] && `ntpd -qdn -p de.pool.ntp.org`
		[ `date +"%Y"` -le 2010 ] && `ntpd -qdn -p us.pool.ntp.org`
	fi

	/usr/sbin/crond
}


cron_stop()
{
	pkill crond
}


set_normal_boot()
{
	NORMALBOOT=1

	if [ -e "/mnt/mmc-config/autorun" ]; then
		NORMALBOOT=0
	fi

	mount /mnt/sd-boot 2>/dev/null
	if [ -e "/mnt/sd-boot/autorun" ]; then
		NORMALBOOT=0
	fi
	umount /mnt/sd-boot 2>/dev/null
}

set_normal_boot

case "$1" in
start)
	cron_start
	;;
stop)
	cron_stop
	;;
restart|reload)
	"$0" stop
	"$0" start
	;;
*)
	echo "Usage: $0 {start|stop|restart}"
	exit 1
esac

exit $?

